<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eko-LÄ°G: Sosyal Tasarruf PortalÄ±</title>
    <style>
        :root { --ana: #27ae60; --uyari: #e67e22; --hata: #e74c3c; --zemin: #f1f5f9; --koyu: #1e293b; --mavi: #3498db; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--zemin); margin: 0; padding: 15px; display: flex; justify-content: center; }
        
        .konteynir { width: 100%; max-width: 1100px; background: white; border-radius: 25px; box-shadow: 0 15px 40px rgba(0,0,0,0.1); padding: clamp(15px, 4vw, 30px); position: relative; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(360px, 1fr)); gap: 25px; margin-top: 20px; }
        .kart { border: 1px solid #e2e8f0; border-radius: 18px; padding: 20px; background: #fff; position: relative; box-shadow: 0 4px 6px rgba(0,0,0,0.02); }
        
        h1 { color: var(--ana); text-align: center; border-bottom: 3px solid var(--ana); padding-bottom: 10px; margin-bottom: 25px; }
        h3 { border-left: 5px solid var(--ana); padding-left: 12px; color: var(--koyu); margin: 0 0 15px 0; font-size: 1.1rem; }

        /* Yeni: Grup SeÃ§imi ve OluÅŸturma AlanÄ± */
        .grup-ust-alan { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .btn-grup-ekle { background: #f1f5f9; border: 1px solid #cbd5e1; color: var(--koyu); padding: 8px 12px; border-radius: 10px; cursor: pointer; font-size: 0.8rem; font-weight: bold; white-space: nowrap; transition: 0.3s; }
        .btn-grup-ekle:hover { background: var(--ana); color: white; border-color: var(--ana); }

        .fatura-kontrol { display: flex; gap: 8px; margin-bottom: 15px; }
        .btn-tarat { flex: 1; background: #fff; color: var(--mavi); border: 1.5px dashed var(--mavi); padding: 10px; border-radius: 12px; cursor: pointer; font-size: 0.8rem; font-weight: bold; transition: 0.2s; }
        .btn-tarat:hover { background: #f0f7ff; transform: translateY(-2px); }

        input, select { width: 100%; padding: 12px; margin: 5px 0 10px 0; border: 1.5px solid #cbd5e1; border-radius: 12px; box-sizing: border-box; font-size: 0.95rem; }
        .uclu { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        label { font-size: 0.75rem; color: #64748b; font-weight: bold; margin-left: 5px; }

        /* Tutorial Overlay */
        .tutorial-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; display: flex; align-items: center; justify-content: center; }
        .tutorial-kart { background: white; padding: 30px; border-radius: 20px; max-width: 400px; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.3); }
        .tutorial-adim { font-weight: bold; color: var(--ana); margin-bottom: 10px; display: block; }
        .tutorial-btn { background: var(--ana); color: white; border: none; padding: 12px 25px; border-radius: 10px; cursor: pointer; margin-top: 20px; width: 100%; font-weight: bold; }

        /* Rozetler ve DiÄŸerleri (Aynen Korundu) */
        .rozet-alani { display: flex; gap: 8px; margin-top: 10px; flex-wrap: wrap; }
        .rozet { padding: 8px 14px; border-radius: 20px; font-size: 0.75rem; background: #f1f5f9; color: #94a3b8; border: 1px solid #e2e8f0; transition: 0.4s; opacity: 0.5; }
        .rozet.aktif { background: #dcfce7; color: #166534; border-color: #22c55e; font-weight: bold; opacity: 1; transform: scale(1.05); box-shadow: 0 4px 10px rgba(34, 197, 94, 0.2); }
        .btn { border: none; padding: 18px; width: 100%; border-radius: 15px; font-weight: bold; cursor: pointer; transition: 0.3s; font-size: 1rem; }
        .btn-ana { background: var(--ana); color: white; margin-top: 15px; box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3); }
        .btn-ana:hover { background: #219150; transform: scale(1.02); }
        .btn-kaydet { background: var(--uyari); color: white; display: none; margin-top: 25px; }
        .lig-item { display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px solid #f1f5f9; font-size: 0.9rem; align-items: center; }
        .user-sira { background: #fff3e0; border: 2px solid var(--uyari); border-radius: 15px; font-weight: bold; color: #d35400; }
        .market-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .m-kart { background: #f8fafc; padding: 15px; border-radius: 15px; text-align: center; border: 1px solid #e2e8f0; transition: 0.3s; }
        .m-btn { width: 100%; border: none; padding: 10px; border-radius: 8px; font-size: 0.75rem; margin-top: 10px; cursor: pointer; font-weight: bold; }
        .m-aktif { background: var(--ana); color: white; }
        .m-pasif { background: #e2e8f0; color: #94a3b8; cursor: not-allowed; }
        #sonuc-paneli { display: none; text-align: center; margin-bottom: 25px; padding: 20px; border-radius: 20px; border: 3px solid #eee; transition: 0.5s; }
    </style>
</head>
<body>

<div id="tutorial" class="tutorial-overlay">
    <div class="tutorial-kart">
        <span class="tutorial-adim" id="adimNo">AdÄ±m 1 / 3</span>
        <h2 id="adimBaslik">HoÅŸ Geldiniz! ğŸŒ±</h2>
        <p id="adimAciklama">Eko-LÄ°G ile enerji tasarrufunu eÄŸlenceye dÃ¶nÃ¼ÅŸtÃ¼rÃ¼n. Ã–nce bilgilerinizi girin ve grubunuzu seÃ§in.</p>
        <button class="tutorial-btn" onclick="sonrakiAdim()">AnladÄ±m, Devam Et</button>
    </div>
</div>

<div class="konteynir">
    <h1>ğŸŒ± EKO-LÄ°G TASARRUF PORTALI</h1>

    <div class="grid">
        <div class="panel">
            <div class="kart">
                <h3>ğŸ‘¤ KatÄ±lÄ±mcÄ± Bilgileri</h3>
                <label>Rumuz</label>
                <input type="text" id="rumuz" placeholder="Ã–rn: TasarrufCan_43">
                
                <div class="grup-ust-alan">
                    <label style="margin:0; flex-grow:1;">YarÄ±ÅŸma Grubu</label>
                    <button class="btn-grup-ekle" onclick="yeniGrupEkle()">+ Grup OluÅŸtur</button>
                </div>
                <select id="grupSecimi">
                    <option value="ilce">Genel Ä°l Ligi (Åehir Ä°smi)</option>
                    <option value="apartman">Bizim Apartman (A Blok)</option>
                    <option value="site">Mavi Site Sakinleri</option>
                    <option value="okul">AtatÃ¼rk Lisesi 11-B Grubu</option>
                </select>

                <h3>âš¡ Elektrik Verileri (kWh)</h3>
                <div class="fatura-kontrol">
                    <button class="btn-tarat" onclick="simuleFatura('e')">ğŸ“· Fatura Tara</button>
                    <button class="btn-tarat" onclick="simuleFatura('e')">ğŸ”— QR Oku</button>
                </div>
                <div class="uclu">
                    <div><label>1. Ay</label><input type="number" id="e1"></div>
                    <div><label>2. Ay</label><input type="number" id="e2"></div>
                    <div><label>GÃ¼ncel</label><input type="number" id="eg" style="border-color: var(--mavi);"></div>
                </div>

                <h3 style="margin-top:20px;">ğŸ”¥ DoÄŸal Gaz Verileri (metrekÃ¼p)</h3>
                <div class="fatura-kontrol">
                    <button class="btn-tarat" onclick="simuleFatura('g')">ğŸ“· Fatura Tara</button>
                    <button class="btn-tarat" onclick="simuleFatura('g')">ğŸ”— QR Oku</button>
                </div>
                <div class="uclu">
                    <div><label>1. Ay</label><input type="number" id="g1"></div>
                    <div><label>2. Ay</label><input type="number" id="g2"></div>
                    <div><label>GÃ¼ncel</label><input type="number" id="gg" style="border-color: var(--mavi);"></div>
                </div>
                
                <button class="btn btn-ana" onclick="hesapla()">VERÄ°LERÄ° ANALÄ°Z ET & LÄ°GE GÄ°R</button>
            </div>

            <div class="kart" style="margin-top:20px;">
                <h3>ğŸ… KazanÄ±lan Rozetler</h3>
                <div class="rozet-alani">
                    <div class="rozet" id="r1">ğŸŒ± BilinÃ§li BaÅŸlangÄ±Ã§</div>
                    <div class="rozet" id="r2">âš¡ Enerji MuhafÄ±zÄ±</div>
                    <div class="rozet" id="r3">ğŸ”¥ Verimlilik ElÃ§isi</div>
                    <div class="rozet" id="r4">ğŸ… Grup Lideri</div>
                </div>
            </div>
        </div>

        <div class="panel">
            <div id="sonuc-paneli">
                <div id="ikon" style="font-size: 3rem; margin-bottom: 10px;">ğŸ†</div>
                <h2 id="mesajGoster" style="margin: 5px 0;">Analiz Bekleniyor...</h2>
                <h1 id="puanGoster" style="margin: 0; color: var(--uyari);">0 Puan</h1>
            </div>

            <div class="kart">
                <h3 id="ligBaslik">ğŸ† Tasarruf Ligi</h3>
                <div id="ligTablo">
                    <div class="lig-item"><span>Ã‡evreci_Muhtar</span><span>%24.1 | 241 Pn</span></div>
                    <div class="lig-item"><span>Esnaf_HÃ¼seyin</span><span>%18.5 | 185 Pn</span></div>
                    <div id="userRow" class="lig-item user-sira" style="display:none;">
                        <span id="uName">SÄ°Z</span><span id="uScore"></span>
                    </div>
                    <div class="lig-item"><span>Ã–ÄŸrenci_AyÅŸe</span><span>%12.2 | 122 Pn</span></div>
                    <div class="lig-item"><span>DoÄŸaDostu_Ali</span><span>%7.4 | 74 Pn</span></div>
                </div>
            </div>

            <div class="kart" style="margin-top:20px;">
                <h3>ğŸ Eko-Market (Hemen Harca)</h3>
                <div class="market-grid">
                    <div class="m-kart"><span>ğŸšŒ</span>Yerel UlaÅŸÄ±m (4 Ãœcretsiz) (50 Pn)<button onclick="harca('UlaÅŸÄ±m Bileti', 50)" class="m-btn m-pasif">Yetersiz</button></div>
                    <div class="m-kart"><span>ğŸ¾</span>AskÄ±da Mama (40 Pn)<button onclick="harca('Mama BaÄŸÄ±ÅŸÄ±', 40)" class="m-btn m-pasif">Yetersiz</button></div>
                    <div class="m-kart"><span>ğŸ›’</span>Market 200 TL Ã‡ek (200 Pn)<button onclick="harca('Market Ä°ndirimi', 200)" class="m-btn m-pasif">Yetersiz</button></div>
                    <div class="m-kart"><span>âœï¸</span>AskÄ±da KÄ±rtasiye (100 Pn)<button onclick="harca('KÄ±rtasiye Ã‡eki', 100)" class="m-btn m-pasif">Yetersiz</button></div>
                </div>
            </div>

            <button id="kaydetBtn" class="btn btn-kaydet" onclick="anketeGit()">âœ… ANALÄ°ZÄ° KAYDET VE ANKETE GÄ°T</button>
        </div>
    </div>
</div>

<script>
let kullaniciPuani = 0;
let mevcutAdim = 1;

// --- YENÄ°: TUTORIAL FONKSÄ°YONU ---
function sonrakiAdim() {
    mevcutAdim++;
    const adimNo = document.getElementById('adimNo');
    const baslik = document.getElementById('adimBaslik');
    const aciklama = document.getElementById('adimAciklama');

    if(mevcutAdim === 2) {
        adimNo.innerText = "AdÄ±m 2 / 3";
        baslik.innerText = "Tasarruf Et, Puan Kazan! ğŸ†";
        aciklama.innerText = "Fatura verilerinizi girerek tÃ¼ketiminizi analiz edin. Tasarruf oranÄ±nÄ±za gÃ¶re Eko-Puan ve Rozet kazanacaksÄ±nÄ±z.";
    } else if(mevcutAdim === 3) {
        adimNo.innerText = "AdÄ±m 3 / 3";
        baslik.innerText = "Ã–dÃ¼lleri Yakala! ğŸ";
        aciklama.innerText = "KazandÄ±ÄŸÄ±nÄ±z puanlarÄ± Eko-Market'te harcayabilir ve ligde Ã¼st sÄ±ralara tÄ±rmanabilirsiniz. HazÄ±rsanÄ±z baÅŸlayalÄ±m!";
    } else {
        document.getElementById('tutorial').style.display = 'none';
    }
}

// --- YENÄ°: GRUP EKLEME FONKSÄ°YONU ---
function yeniGrupEkle() {
    const yeniGrup = prompt("OluÅŸturmak istediÄŸiniz grup adÄ±nÄ± girin:");
    if(yeniGrup && yeniGrup.trim() !== "") {
        const select = document.getElementById('grupSecimi');
        const option = document.createElement("option");
        option.text = yeniGrup;
        option.value = yeniGrup.toLowerCase().replace(/\s/g, '');
        select.add(option);
        select.value = option.value;
        alert(yeniGrup + " grubu baÅŸarÄ±yla oluÅŸturuldu ve seÃ§ildi!");
    }
}

// --- MEVCUT FONKSÄ°YONLAR (Aynen Korundu) ---
function simuleFatura(tip) {
    alert("Fatura/QR baÅŸarÄ±yla analiz edildi. Veriler otomatik dolduruluyor...");
    if(tip === 'e') {
        document.getElementById('e1').value = 650; document.getElementById('e2').value = 610; document.getElementById('eg').value = 520;
    } else {
        document.getElementById('g1').value = 1300; document.getElementById('g2').value = 1250; document.getElementById('gg').value = 980;
    }
}

function hesapla() {
    const e1 = parseFloat(document.getElementById('e1').value) || 0;
    const e2 = parseFloat(document.getElementById('e2').value) || 0;
    const eg = parseFloat(document.getElementById('eg').value) || 0;
    const g1 = parseFloat(document.getElementById('g1').value) || 0;
    const g2 = parseFloat(document.getElementById('g2').value) || 0;
    const gg = parseFloat(document.getElementById('gg').value) || 0;

    if(!eg || !gg) { alert("LÃ¼tfen gÃ¼ncel ay verilerini giriniz!"); return; }

    const eskiOrt = ((e1 + e2) / 2) + ((g1 + g2) / 2);
    const guncel = eg + gg;
    const oran = ((eskiOrt - guncel) / eskiOrt) * 100;
    kullaniciPuani = oran > 0 ? Math.floor(oran * 10) : 0;

    const panel = document.getElementById('sonuc-paneli');
    const mesaj = document.getElementById('mesajGoster');
    const ikon = document.getElementById('ikon');
    panel.style.display = "block";

    if (oran >= 0) {
        ikon.innerText = "ğŸ†";
        panel.style.borderColor = "var(--ana)";
        panel.style.background = "#f0fff4";
        mesaj.innerHTML = `<span style="color:var(--ana)">%${oran.toFixed(1)} Tasarruf SaÄŸlandÄ±!</span>`;
    } else {
        const artis = Math.abs(oran).toFixed(1);
        ikon.innerText = "âš ï¸";
        panel.style.borderColor = "var(--hata)";
        panel.style.background = "#fff5f5";
        mesaj.innerHTML = `<span style="color:var(--hata)">TÃ¼ketiminiz %${artis} ArttÄ±!</span>`;
    }

    document.getElementById('puanGoster').innerText = kullaniciPuani + " Eko-Puan";
    const secilenGrup = document.getElementById('grupSecimi').options[document.getElementById('grupSecimi').selectedIndex].text;
    document.getElementById('ligBaslik').innerText = "ğŸ† " + secilenGrup;
    document.getElementById('userRow').style.display = "flex";
    document.getElementById('uName').innerText = (document.getElementById('rumuz').value || "SÄ°Z").toUpperCase();
    document.getElementById('uScore').innerText = (oran >= 0 ? "%" : "+%") + Math.abs(oran).toFixed(1) + " | " + kullaniciPuani + " Pn";

    document.getElementById('r1').classList.add('aktif');
    if(kullaniciPuani > 80) document.getElementById('r2').classList.add('aktif');
    if(kullaniciPuani > 150) document.getElementById('r3').classList.add('aktif');

    const btns = document.querySelectorAll('.m-btn');
    const maliyetler = [50, 40, 200, 100];
    btns.forEach((btn, i) => {
        if(kullaniciPuani >= maliyetler[i]) {
            btn.innerText = "Kuponu Al"; btn.className = "m-btn m-aktif"; btn.disabled = false;
        } else {
            btn.innerText = "Yetersiz"; btn.className = "m-btn m-pasif"; btn.disabled = true;
        }
    });

    document.getElementById('kaydetBtn').style.display = "block";
    document.getElementById('kaydetBtn').scrollIntoView({behavior: "smooth"});
}

function harca(urun, bedel) {
    if(kullaniciPuani >= bedel) {
        kullaniciPuani -= bedel;
        document.getElementById('puanGoster').innerText = kullaniciPuani + " Eko-Puan";
        alert("Harika! " + urun + " Ã¶dÃ¼lÃ¼nÃ¼z tanÄ±mlandÄ±.\nKod: EKO-" + Math.floor(Math.random()*9000 + 1000));
        hesapla(); 
    }
}

function anketeGit() {
    window.open(`https://forms.gle/oX2Kg4d3PHeWWUPV6`, "_blank");
}
</script>
</body>
</html>